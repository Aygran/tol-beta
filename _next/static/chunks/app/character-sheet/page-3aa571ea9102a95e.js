(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[780],{7096:function(e,t,r){Promise.resolve().then(r.bind(r,2207))},7907:function(e,t,r){"use strict";var a=r(5313);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},2207:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var a=r(3827),s=r(4090),l=r(3779),i=r(4624),n=r(7907);let d="lastSelectedCharacter";function c(){let{user:e,loading:t}=(0,l.useAuth)(),r=(0,n.useRouter)(),[c,o]=(0,s.useState)({}),[u,h]=(0,s.useState)(!1),[b,m]=(0,s.useState)(null),[x,p]=(0,s.useState)(!1),[g,f]=(0,s.useState)([]),[j,y]=(0,s.useState)([]),[v,N]=(0,s.useState)(""),[w,A]=(0,s.useState)([]),[S,C]=(0,s.useState)(""),[I,E]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t||e?e&&P():r.push("/login")},[e,t,r]),(0,s.useEffect)(()=>{if(S){let e=w.find(e=>e.id===S);e&&(o(e.values),f(e.abilities),y(e.equipment),N(e.characterName))}else o({}),f([]),y([]),N("")},[S,w]);let P=async()=>{if(e)try{E(!0);let t=await i.B.getCharacterSheets(e.uid);A(t);let r=localStorage.getItem(d);if(r&&t.some(e=>e.id===r))C(r);else if(t.length>0){let e=t.reduce((e,t)=>t.updatedAt>e.updatedAt?t:e);e.id&&C(e.id)}}catch(e){console.error("Failed to load characters:",e),m({type:"error",message:"Failed to load characters. Please try again."})}finally{E(!1)}};(0,s.useEffect)(()=>{if(b){p(!0);let e=setTimeout(()=>{p(!1),setTimeout(()=>{m(null)},500)},3e3);return()=>clearTimeout(e)}},[b]);let R=e=>{C(e),localStorage.setItem(d,e)},D=async()=>{if(e){if(!v.trim()){m({type:"error",message:"Please enter a character name"});return}try{E(!0),S?await i.B.updateCharacterSheet(S,{name:v,values:c,abilities:g,equipment:j}):await i.B.createCharacterSheet({userId:e.uid,characterName:v,values:c,abilities:g,equipment:j}),m({type:"success",message:"Character saved successfully!"}),await P()}catch(e){console.error("Failed to save character:",e),m({type:"error",message:"Failed to save character. Please try again."})}finally{E(!1)}}},k=e=>{let t={ARC:0,DIS:1,INS:2,MAR:3,"Arcana (ARC)":0,"Discipline (DIS)":1,"Insight (INS)":2,"Martial (MAR)":3}[e];return void 0===t?"":M(c["value-row".concat(t+1)]||"")},M=e=>{let t=parseInt(e);return isNaN(t)?"":Math.floor((t-10)/2).toString()},F=(e,t)=>{o(r=>({...r,[e]:t}))},z=(e,t)=>{let r=c["value-row".concat(e+1)]||"";return["Arcana (ARC)","Discipline (DIS)","Insight (INS)","Martial (MAR)"].includes(t)?M(r):r},L=e=>{let t=parseInt(k(e));return isNaN(t)?"":(t+10).toString()},V=e=>{switch(e.toUpperCase()){case"-":default:return 0;case"K":return 2;case"J":return 4;case"V":return 6;case"M":return 8}},J=(e,t)=>{let r=parseInt(k(e)),a=V(t);return isNaN(r)?"":(r+a).toString()},T=[{header:"Attribute",cells:[,,,,].fill(null).map((e,t)=>({id:"label-row".concat(t+1),placeholder:0===t?"Arcana (ARC)":1===t?"Discipline (DIS)":2===t?"Insight (INS)":"Martial (MAR)",isEditable:!1}))},{header:"Score",width:"5rem",cells:[,,,,].fill(null).map((e,t)=>({id:"value-row".concat(t+1),placeholder:"10",isEditable:!0}))},{header:"Modifier",cells:[,,,,].fill(null).map((e,t)=>({id:"display-row".concat(t+1),placeholder:"Value will appear here",isEditable:!1}))}];return t?(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}):I?(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white text-xl",children:"Loading characters..."})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 py-8 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("input",{type:"text",value:v,onChange:e=>N(e.target.value),placeholder:"Enter character name",className:"bg-black border border-gray-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsxs)("select",{value:S,onChange:e=>R(e.target.value),className:"bg-black border border-gray-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"New Character"}),w.map(e=>(0,a.jsx)("option",{value:e.id,children:e.characterName},e.id))]})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{onClick:()=>{o({}),f([]),y([]),N(""),C("")},className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"New Character"}),(0,a.jsx)("button",{onClick:D,disabled:I,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:bg-gray-600 disabled:cursor-not-allowed",children:I?"Saving...":"Save Character"}),(0,a.jsx)("button",{onClick:()=>h(!0),className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Reset"})]})]}),b&&(0,a.jsx)("div",{className:"fixed top-4 right-4 p-4 rounded shadow-lg ".concat("success"===b.type?"bg-green-500":"bg-red-500"," text-white transition-opacity duration-500 ").concat(x?"opacity-100":"opacity-0"),children:b.message}),u&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Confirm Reset"}),(0,a.jsx)("p",{className:"mb-6",children:"Are you sure you want to reset all values? This action cannot be undone."}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{onClick:()=>h(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{h(!1),o({}),f([]),y([]),N(""),C("")},className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors",children:"Reset"})]})]})}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-xl font-semibold mb-2",children:"Name"}),(0,a.jsx)("input",{type:"text",id:"name-input",placeholder:"Enter character name",value:c["name-input"]||"",onChange:e=>F("name-input",e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"}),(0,a.jsx)("input",{type:"text",id:"race-input",placeholder:"Enter character race",value:c["race-input"]||"",onChange:e=>F("race-input",e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"}),(0,a.jsx)("input",{type:"text",id:"occupation-input",placeholder:"Enter character occupation",value:c["occupation-input"]||"",onChange:e=>F("occupation-input",e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"}),(0,a.jsx)("input",{type:"text",id:"level-input",placeholder:"Enter character level",value:c["level-input"]||"",onChange:e=>F("level-input",e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"})]}),(0,a.jsxs)("div",{className:"flex gap-8",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-xl font-semibold mb-4",children:"Attributes"}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{children:T.map((e,t)=>(0,a.jsx)("th",{className:"border border-gray-300 p-2",style:{width:e.width},children:e.header},"header-".concat(t)))})}),(0,a.jsx)("tbody",{children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("tr",{children:T.map((e,r)=>(0,a.jsx)("td",{className:"border border-gray-300 p-2",style:{width:e.width},children:e.cells[t].isEditable?(0,a.jsx)("input",{type:"text",id:e.cells[t].id,placeholder:e.cells[t].placeholder,value:c[e.cells[t].id]||"",onChange:r=>F(e.cells[t].id,r.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500"}):(0,a.jsx)("div",{className:"w-full p-1 font-medium",children:2===r?z(t,T[0].cells[t].placeholder):e.cells[t].placeholder})},e.cells[t].id))},"row-".concat(t)))})]})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-xl font-semibold mb-4",children:"Spell Pass Rating"}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Attribute"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Rating"})]})}),(0,a.jsx)("tbody",{children:[{label:"Spell Pass Rating (ARC)",attribute:"Arcana (ARC)"},{label:"Spell Pass Rating (DIS)",attribute:"Discipline (DIS)"},{label:"Spell Pass Rating (INS)",attribute:"Insight (INS)"},{label:"Spell Pass Rating (MAR)",attribute:"Martial (MAR)"}].map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2 font-medium",children:e.label}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:L(e.attribute)})]},"spr-row-".concat(t)))})]})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-xl font-semibold mb-4",children:"Hit Points"}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Label"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Value"})]})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2 font-medium",children:"Max Hit Points"}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"text",id:"max-hp-input",placeholder:"0",value:c["max-hp-input"]||"",onChange:e=>F("max-hp-input",e.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500"})})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2 font-medium",children:"Current Hit Points"}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"text",id:"current-hp-input",placeholder:"0",value:c["current-hp-input"]||"",onChange:e=>F("current-hp-input",e.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500"})})]})]})]})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-xl font-semibold mb-4",children:"Mana Points"}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Label"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Value"})]})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2 font-medium",children:"Max Mana Points"}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"text",id:"max-mp-input",placeholder:"0",value:c["max-mp-input"]||"",onChange:e=>F("max-mp-input",e.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500"})})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2 font-medium",children:"Current Mana Points"}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"text",id:"current-mp-input",placeholder:"0",value:c["current-mp-input"]||"",onChange:e=>F("current-mp-input",e.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500"})})]})]})]})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-xl font-semibold mb-4",children:"Action Points"}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Label"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Value"})]})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2 font-medium",children:"Max Action Points"}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"text",id:"max-ap-input",placeholder:"0",value:c["max-ap-input"]||"",onChange:e=>F("max-ap-input",e.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500"})})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2 font-medium",children:"Current Action Points"}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"text",id:"current-ap-input",placeholder:"0",value:c["current-ap-input"]||"",onChange:e=>F("current-ap-input",e.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500"})})]})]})]})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-xl font-semibold text-white mb-4",children:"Abilities"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[g.map((e,t)=>(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("span",{className:"px-2 py-1 bg-blue-900 text-blue-200 rounded text-sm",children:["Tier ",e.tier]}),e.isFocus&&(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-900 text-purple-200 rounded text-sm",children:"Focus"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-gray-300 mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"AP:"})," ",e.ap]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"MP:"})," ",e.mp]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Range:"})," ",e.range]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Duration:"})," ",e.duration]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Damage:"})," ",e.damage]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"SPR:"})," ",e.spellPassRating]})]}),(0,a.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:e.description}),e.upgrades&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm text-gray-300",children:"Upgrades:"}),(0,a.jsx)("p",{className:"text-gray-300 text-sm",children:e.upgrades})]})]},t)),0===g.length&&(0,a.jsx)("div",{className:"text-center text-gray-400 py-8",children:"No abilities added yet. Visit the Abilities page to add some!"})]})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-xl font-semibold mb-4",children:"Skills"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Skill Levels: - (0), K (+2), J (+4), V (+6), M (+8)"}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Skill"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Attribute"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",style:{width:"5rem"},children:"Level"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2 text-left",children:"Total"})]})}),(0,a.jsx)("tbody",{children:[{label:"Athletics",attribute:"MAR"},{label:"Crafting",attribute:"ANY"},{label:"Diplomacy",attribute:"MAR"},{label:"Deception",attribute:"DIS"},{label:"Guile",attribute:"DIS"},{label:"Healing",attribute:"INS"},{label:"Hunting",attribute:"DIS"},{label:"Intuition",attribute:"INS"},{label:"Lore",attribute:"ARC"},{label:"Perception",attribute:"INS"},{label:"Machinery",attribute:"ARC"},{label:"Song & Story",attribute:"DIS"},{label:"Stealth",attribute:"DIS"}].map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2 font-medium",children:e.label}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:"Crafting"===e.label?(0,a.jsx)("input",{type:"text",id:"skill-attribute-".concat(t),placeholder:"ANY",value:c["skill-attribute-".concat(t)]||"",onChange:e=>F("skill-attribute-".concat(t),e.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500"}):e.attribute}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:(0,a.jsx)("input",{type:"text",id:"skill-value-".concat(t),placeholder:"-",value:c["skill-value-".concat(t)]||"",onChange:e=>{let r=e.target.value.toUpperCase();(""===r||["-","K","J","V","M"].includes(r))&&F("skill-value-".concat(t),r)},className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500 text-center"})}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:"Crafting"===e.label?(0,a.jsx)("input",{type:"text",id:"skill-total-".concat(t),placeholder:"0",value:c["skill-total-".concat(t)]||"",onChange:e=>F("skill-total-".concat(t),e.target.value),className:"w-full p-1 border border-gray-200 rounded focus:outline-none focus:border-blue-500 text-center"}):"ANY"===e.attribute?"":J(e.attribute,c["skill-value-".concat(t)]||"")})]},"skill-row-".concat(t)))})]}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("div",{className:"text-xl font-semibold text-white mb-4",children:"Equipment"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[j.map((e,t)=>(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-1 bg-blue-900 text-blue-200 rounded text-sm",children:e.type})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-300",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Quantity:"})," ",e.quantity]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Weight:"})," ",e.weight]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Value:"})," ",e.value]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"AV:"})," ",e.av]}),e.notes&&(0,a.jsxs)("div",{className:"col-span-2 text-gray-300",children:[(0,a.jsx)("span",{className:"font-medium",children:"Notes:"})," ",e.notes]})]})]},t)),0===j.length&&(0,a.jsx)("div",{className:"text-center text-gray-400 py-8",children:"No equipment items added yet. Visit the Equipment page to add some!"})]})]})]})]})]})})}},3779:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return d},useAuth:function(){return c}});var a=r(3827),s=r(4090),l=r(7065),i=r(1221);let n=(0,s.createContext)({user:null,loading:!0,signUp:async()=>{throw Error("AuthProvider not initialized")},signIn:async()=>{throw Error("AuthProvider not initialized")},signInWithGoogle:async()=>{throw Error("AuthProvider not initialized")},logout:async()=>{throw Error("AuthProvider not initialized")},verifyEmail:async()=>{throw Error("AuthProvider not initialized")}});function d(e){let{children:t}=e,[r,d]=(0,s.useState)(null),[c,o]=(0,s.useState)(!0);(0,s.useEffect)(()=>{if(!i.I){o(!1);return}let e=(0,l.Aj)(i.I,e=>{d(e),o(!1)});return()=>e()},[]);let u=async(e,t)=>{if(!i.I)throw Error("Authentication service is not available");let r=await (0,l.Xb)(i.I,e,t);return await (0,l.w$)(r.user),r},h=async(e,t)=>{if(!i.I)throw Error("Authentication service is not available");await (0,l.e5)(i.I,e,t)},b=async()=>{if(!i.I)throw Error("Authentication service is not available");let e=new l.hJ;await (0,l.rh)(i.I,e)},m=async()=>{if(!i.I)throw Error("Authentication service is not available");await (0,l.w7)(i.I)},x=async()=>{if(!(null===i.I||void 0===i.I?void 0:i.I.currentUser))throw Error("No user logged in");await (0,l.w$)(i.I.currentUser)};return(0,a.jsx)(n.Provider,{value:{user:r,loading:c,signUp:u,signIn:h,signInWithGoogle:b,logout:m,verifyEmail:x},children:t})}let c=()=>(0,s.useContext)(n)},1221:function(e,t,r){"use strict";let a,s,l;r.d(t,{I:function(){return s},db:function(){return l}});var i=r(6142),n=r(7065),d=r(8121);a=(0,i.C6)().length?(0,i.C6)()[0]:(0,i.ZF)({apiKey:"dummy",authDomain:"dummy",projectId:"dummy",storageBucket:"dummy",messagingSenderId:"dummy",appId:"dummy",measurementId:"dummy"}),s=(0,n.v0)(a),l=(0,d.ad)(a)},4624:function(e,t,r){"use strict";r.d(t,{B:function(){return i}});var a=r(8121),s=r(1221);class l{async createCharacterSheet(e){if(!s.db)throw Error("Firestore is not initialized");let t=new Date;return{id:(await (0,a.ET)(this.characterSheetsCollection,{...e,createdAt:t,updatedAt:t})).id,...e,createdAt:t,updatedAt:t}}async getCharacterSheets(e){if(!s.db)throw Error("Firestore is not initialized");let t=(0,a.IO)(this.characterSheetsCollection,(0,a.ar)("userId","==",e),(0,a.Xo)("updatedAt","desc"));return(await (0,a.PL)(t)).docs.map(e=>{var t,r;return{id:e.id,...e.data(),createdAt:null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(r=e.data().updatedAt)||void 0===r?void 0:r.toDate()}})}async getCharacterSheet(e){var t,r;if(!s.db)throw Error("Firestore is not initialized");let l=(0,a.JU)(this.characterSheetsCollection,e),i=await (0,a.QT)(l);if(!i.exists())return null;let n=i.data();return{id:i.id,...n,createdAt:null===(t=n.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(r=n.updatedAt)||void 0===r?void 0:r.toDate()}}async updateCharacterSheet(e,t){if(!s.db)throw Error("Firestore is not initialized");let r=(0,a.JU)(this.characterSheetsCollection,e);await (0,a.r7)(r,{...t,updatedAt:new Date})}async deleteCharacterSheet(e){if(!s.db)throw Error("Firestore is not initialized");let t=(0,a.JU)(this.characterSheetsCollection,e);await (0,a.oe)(t)}async subscribeToNewsletter(e,t){if(!s.db)throw Error("Firestore is not initialized");let r={userId:e,email:t,subscribedAt:new Date,isActive:!0};await (0,a.ET)(this.newsletterCollection,r)}async getNewsletterSubscription(e){var t;if(!s.db)throw Error("Firestore is not initialized");let r=(0,a.IO)(this.newsletterCollection,(0,a.ar)("userId","==",e),(0,a.b9)(1)),l=await (0,a.PL)(r);if(l.empty)return null;let i=l.docs[0].data();return{userId:i.userId,email:i.email,subscribedAt:null===(t=i.subscribedAt)||void 0===t?void 0:t.toDate(),isActive:i.isActive}}async unsubscribeFromNewsletter(e){if(!s.db)throw Error("Firestore is not initialized");let t=(0,a.IO)(this.newsletterCollection,(0,a.ar)("userId","==",e),(0,a.b9)(1)),r=await (0,a.PL)(t);if(!r.empty){let e=(0,a.JU)(this.newsletterCollection,r.docs[0].id);await (0,a.r7)(e,{isActive:!1})}}constructor(){if(!s.db)throw Error("Firestore is not initialized");this.characterSheetsCollection=(0,a.hJ)(s.db,"characterSheets"),this.newsletterCollection=(0,a.hJ)(s.db,"newsletterSubscriptions")}}let i=new l}},function(e){e.O(0,[358,657,897,971,69,744],function(){return e(e.s=7096)}),_N_E=e.O()}]);