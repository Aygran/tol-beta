(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{5403:function(e,t,i){Promise.resolve().then(i.bind(i,9856))},7907:function(e,t,i){"use strict";var r=i(5313);i.o(r,"usePathname")&&i.d(t,{usePathname:function(){return r.usePathname}}),i.o(r,"useRouter")&&i.d(t,{useRouter:function(){return r.useRouter}})},9856:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return d}});var r=i(3827),a=i(4090),s=i(3779),o=i(4624),n=i(7907);function d(){let{user:e,loading:t}=(0,s.useAuth)(),i=(0,n.useRouter)(),[d,l]=(0,a.useState)([]),[c,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),[g,b]=(0,a.useState)(!0),[x,f]=(0,a.useState)("");(0,a.useEffect)(()=>{t||e||i.push("/login")},[t,e,i]),(0,a.useEffect)(()=>{(async()=>{if(e)try{b(!0);let t=(await o.B.getCharacterSheets(e.uid)).reduce((e,t)=>t.updatedAt>e.updatedAt?t:e);l((null==t?void 0:t.abilities)||[])}catch(e){f("Failed to load abilities"),console.error("Error loading abilities:",e)}finally{b(!1)}})()},[e]),(0,a.useEffect)(()=>{if(c){h(!0);let e=setTimeout(()=>{h(!1),setTimeout(()=>{u(null)},500)},3e3);return()=>clearTimeout(e)}},[c]);let w=async()=>{if(e)try{b(!0);let t=(await o.B.getCharacterSheets(e.uid)).reduce((e,t)=>t.updatedAt>e.updatedAt?t:e);t&&await o.B.updateCharacterSheet(t.id,{abilities:d}),u({type:"success",message:"Abilities saved successfully!"})}catch(e){f("Failed to save abilities"),console.error("Error saving abilities:",e),u({type:"error",message:"Failed to save abilities. Please try again."})}finally{b(!1)}},p=(e,t,i)=>{l(d.map(r=>r.id===e?{...r,[t]:i}:r))},v=e=>{l(d.filter(t=>t.id!==e))};return t||g?(0,r.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-white",children:"Loading..."})}):e?(0,r.jsx)("div",{className:"min-h-screen bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Abilities"}),(0,r.jsx)("button",{onClick:w,disabled:g,className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-600 disabled:cursor-not-allowed",children:g?"Saving...":"Save"})]}),x&&(0,r.jsx)("div",{className:"bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded relative mb-4",role:"alert",children:(0,r.jsx)("span",{className:"block sm:inline",children:x})}),c&&(0,r.jsx)("div",{className:"fixed top-4 right-4 p-4 rounded shadow-lg ".concat("success"===c.type?"bg-green-500":"bg-red-500"," text-white transition-opacity duration-500 ").concat(m?"opacity-100":"opacity-0"),children:c.message}),(0,r.jsxs)("div",{className:"space-y-6",children:[d.map(e=>(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"name-".concat(e.id),className:"block text-sm font-medium text-white",children:"Name"}),(0,r.jsx)("input",{type:"text",id:"name-".concat(e.id),value:e.name,onChange:t=>p(e.id,"name",t.target.value),className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"tier-".concat(e.id),className:"block text-sm font-medium text-white",children:"Tier"}),(0,r.jsx)("input",{type:"text",id:"tier-".concat(e.id),value:e.tier,onChange:t=>p(e.id,"tier",t.target.value),className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"ap-".concat(e.id),className:"block text-sm font-medium text-white",children:"AP"}),(0,r.jsx)("input",{type:"text",id:"ap-".concat(e.id),value:e.ap,onChange:t=>p(e.id,"ap",t.target.value),className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"mp-".concat(e.id),className:"block text-sm font-medium text-white",children:"MP"}),(0,r.jsx)("input",{type:"text",id:"mp-".concat(e.id),value:e.mp,onChange:t=>p(e.id,"mp",t.target.value),className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"range-".concat(e.id),className:"block text-sm font-medium text-white",children:"Range"}),(0,r.jsx)("input",{type:"text",id:"range-".concat(e.id),value:e.range,onChange:t=>p(e.id,"range",t.target.value),className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"duration-".concat(e.id),className:"block text-sm font-medium text-white",children:"Duration"}),(0,r.jsx)("input",{type:"text",id:"duration-".concat(e.id),value:e.duration,onChange:t=>p(e.id,"duration",t.target.value),className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"damage-".concat(e.id),className:"block text-sm font-medium text-white",children:"Damage"}),(0,r.jsx)("input",{type:"text",id:"damage-".concat(e.id),value:e.damage,onChange:t=>p(e.id,"damage",t.target.value),className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"spellPassRating-".concat(e.id),className:"block text-sm font-medium text-white",children:"Spell Pass Rating"}),(0,r.jsx)("input",{type:"text",id:"spellPassRating-".concat(e.id),value:e.spellPassRating,onChange:t=>p(e.id,"spellPassRating",t.target.value),className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"isFocus-".concat(e.id),checked:e.isFocus,onChange:t=>p(e.id,"isFocus",t.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-700 rounded bg-gray-900"}),(0,r.jsx)("label",{htmlFor:"isFocus-".concat(e.id),className:"ml-2 block text-sm text-white",children:"Focus"})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{htmlFor:"description-".concat(e.id),className:"block text-sm font-medium text-white",children:"Description"}),(0,r.jsx)("textarea",{id:"description-".concat(e.id),value:e.description,onChange:t=>p(e.id,"description",t.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{htmlFor:"upgrades-".concat(e.id),className:"block text-sm font-medium text-white",children:"Upgrades"}),(0,r.jsx)("textarea",{id:"upgrades-".concat(e.id),value:e.upgrades,onChange:t=>p(e.id,"upgrades",t.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-700 bg-gray-900 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("button",{type:"button",onClick:()=>v(e.id),className:"text-red-500 hover:text-red-400",children:"Remove Ability"})})]},e.id)),(0,r.jsx)("button",{type:"button",onClick:()=>{l([...d,{id:Date.now().toString(),name:"",tier:"",ap:"",mp:"",range:"",duration:"",damage:"",spellPassRating:"",description:"",upgrades:"",isFocus:!1}])},className:"w-full bg-gray-800 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Add Ability"})]})]})}):null}},3779:function(e,t,i){"use strict";i.r(t),i.d(t,{AuthProvider:function(){return d},useAuth:function(){return l}});var r=i(3827),a=i(4090),s=i(7065),o=i(1221);let n=(0,a.createContext)({user:null,loading:!0,signUp:async()=>{throw Error("AuthProvider not initialized")},signIn:async()=>{throw Error("AuthProvider not initialized")},signInWithGoogle:async()=>{throw Error("AuthProvider not initialized")},logout:async()=>{throw Error("AuthProvider not initialized")},verifyEmail:async()=>{throw Error("AuthProvider not initialized")}});function d(e){let{children:t}=e,[i,d]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(!o.I){c(!1);return}let e=(0,s.Aj)(o.I,e=>{d(e),c(!1)});return()=>e()},[]);let u=async(e,t)=>{if(!o.I)throw Error("Authentication service is not available");let i=await (0,s.Xb)(o.I,e,t);return await (0,s.w$)(i.user),i},m=async(e,t)=>{if(!o.I)throw Error("Authentication service is not available");await (0,s.e5)(o.I,e,t)},h=async()=>{if(!o.I)throw Error("Authentication service is not available");let e=new s.hJ;await (0,s.rh)(o.I,e)},g=async()=>{if(!o.I)throw Error("Authentication service is not available");await (0,s.w7)(o.I)},b=async()=>{if(!(null===o.I||void 0===o.I?void 0:o.I.currentUser))throw Error("No user logged in");await (0,s.w$)(o.I.currentUser)};return(0,r.jsx)(n.Provider,{value:{user:i,loading:l,signUp:u,signIn:m,signInWithGoogle:h,logout:g,verifyEmail:b},children:t})}let l=()=>(0,a.useContext)(n)},1221:function(e,t,i){"use strict";let r,a,s;i.d(t,{I:function(){return a},db:function(){return s}});var o=i(6142),n=i(7065),d=i(8121);r=(0,o.C6)().length?(0,o.C6)()[0]:(0,o.ZF)({apiKey:"dummy",authDomain:"dummy",projectId:"dummy",storageBucket:"dummy",messagingSenderId:"dummy",appId:"dummy",measurementId:"dummy"}),a=(0,n.v0)(r),s=(0,d.ad)(r)},4624:function(e,t,i){"use strict";i.d(t,{B:function(){return o}});var r=i(8121),a=i(1221);class s{async createCharacterSheet(e){if(!a.db)throw Error("Firestore is not initialized");let t=new Date;return{id:(await (0,r.ET)(this.characterSheetsCollection,{...e,createdAt:t,updatedAt:t})).id,...e,createdAt:t,updatedAt:t}}async getCharacterSheets(e){if(!a.db)throw Error("Firestore is not initialized");let t=(0,r.IO)(this.characterSheetsCollection,(0,r.ar)("userId","==",e),(0,r.Xo)("updatedAt","desc"));return(await (0,r.PL)(t)).docs.map(e=>{var t,i;return{id:e.id,...e.data(),createdAt:null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(i=e.data().updatedAt)||void 0===i?void 0:i.toDate()}})}async getCharacterSheet(e){var t,i;if(!a.db)throw Error("Firestore is not initialized");let s=(0,r.JU)(this.characterSheetsCollection,e),o=await (0,r.QT)(s);if(!o.exists())return null;let n=o.data();return{id:o.id,...n,createdAt:null===(t=n.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(i=n.updatedAt)||void 0===i?void 0:i.toDate()}}async updateCharacterSheet(e,t){if(!a.db)throw Error("Firestore is not initialized");let i=(0,r.JU)(this.characterSheetsCollection,e);await (0,r.r7)(i,{...t,updatedAt:new Date})}async deleteCharacterSheet(e){if(!a.db)throw Error("Firestore is not initialized");let t=(0,r.JU)(this.characterSheetsCollection,e);await (0,r.oe)(t)}async subscribeToNewsletter(e,t){if(!a.db)throw Error("Firestore is not initialized");let i={userId:e,email:t,subscribedAt:new Date,isActive:!0};await (0,r.ET)(this.newsletterCollection,i)}async getNewsletterSubscription(e){var t;if(!a.db)throw Error("Firestore is not initialized");let i=(0,r.IO)(this.newsletterCollection,(0,r.ar)("userId","==",e),(0,r.b9)(1)),s=await (0,r.PL)(i);if(s.empty)return null;let o=s.docs[0].data();return{userId:o.userId,email:o.email,subscribedAt:null===(t=o.subscribedAt)||void 0===t?void 0:t.toDate(),isActive:o.isActive}}async unsubscribeFromNewsletter(e){if(!a.db)throw Error("Firestore is not initialized");let t=(0,r.IO)(this.newsletterCollection,(0,r.ar)("userId","==",e),(0,r.b9)(1)),i=await (0,r.PL)(t);if(!i.empty){let e=(0,r.JU)(this.newsletterCollection,i.docs[0].id);await (0,r.r7)(e,{isActive:!1})}}constructor(){if(!a.db)throw Error("Firestore is not initialized");this.characterSheetsCollection=(0,r.hJ)(a.db,"characterSheets"),this.newsletterCollection=(0,r.hJ)(a.db,"newsletterSubscriptions")}}let o=new s}},function(e){e.O(0,[358,657,897,971,69,744],function(){return e(e.s=5403)}),_N_E=e.O()}]);